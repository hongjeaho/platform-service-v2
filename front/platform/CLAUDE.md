# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a React 19 + TypeScript frontend application built with Vite. It implements a comprehensive design system with CSS variables, Jotai for state management, React Router for routing, and TanStack Query for data fetching.

## Development Commands

```bash
# Development
yarn dev                    # Start dev server on port 3000

# Building
yarn build                  # Generate API clients, format, lint, type-check, and build
yarn orval                  # Generate API clients from OpenAPI spec
yarn orval:watch            # Watch mode for API client generation

# Code Quality
yarn lint:fix               # Auto-fix ESLint issues
yarn format                 # Format code with Prettier
yarn test                   # Run Vitest tests
yarn test:ui                # Run tests with UI
yarn test:coverage          # Run tests with coverage report

# Storybook
yarn storybook              # Start Storybook on port 6006
yarn storybook:build        # Build Storybook static site
```

## Architecture

### Directory Structure

```
src/
├── common/
│   ├── components/ui/      # Reusable UI components (design system)
│   ├── hooks/              # Custom React hooks (auth, utilities)
│   └── message/store/      # Global message state (alerts/confirmations)
├── constants/
│   └── design/             # Design tokens (color, spacing, typography, icons)
├── layout/                 # Layout components (BaseLayout, AuthenticationLayout, etc.)
├── router/                 # React Router configuration
├── utils/http/             # Axios instance and interceptors
├── views/                  # Page-level components
└── gen/                    # API clients generated by Orval
```

### Path Aliases (tsconfig.paths.json)

- `@/*` → `src/*`
- `@components/*` → `src/components/*`
- `@constants/*` → `src/constants/*`
- `@utils/*` → `src/utils/*`
- `@views/*` → `src/views/*`
- `@router/*` → `src/router/*`
- `@hooks/*` → `src/common/hooks/*`
- `@api/*` → `src/gen/*`

## Design System (Critical)

This project uses a **strict design token system**. **Always import design tokens from `@/constants/design`**. Never hardcode values.

### Design Token Import

```typescript
import {
  brandColors,
  semanticColors,
  buttonVariants,
  statusColors,
  textCombinations,
  padding,
  gap,
  borderRadius,
  icons,
  iconSizes,
  iconVariants,
} from '@/constants/design'
```

### Key Rules (from .cursor/rules/design-system.mdc)

1. **Colors**: Use semantic tokens (`bg-primary`, `text-primary-foreground`), never raw colors (`bg-blue-600`, `#1a73e8`)
2. **Typography**: Use combination tokens (`textCombinations.h1`, `textCombinations.body`)
3. **Spacing**: Use token classes (`padding.buttonMd`, `gap.default`) in 4px increments
4. **Icons**: Import from `icons` object (`icons.add`), never directly from lucide-react
5. **CSS**: Use CSS Modules only (`.module.css`). No `:global`, `:root`, or `!important`

### Component Pattern

```typescript
import { cn } from '@/lib/utils'
import { padding, borderRadius, gap } from '@/constants/design/spacing'

<div className={cn(
  padding.card,
  borderRadius.lg,
  'bg-card border border-border'
)}>
  {children}
</div>
```

## State Management

### Jotai Atoms

**Authentication** (`src/common/hooks/auth/store/auth/index.ts`):

- `authStatusAtom`: Authentication status
- `userDataAtom`: User data (not hydration-safe)
- `hydratedUserDataAtom`: Hydration-safe user data (use in components)

**Messages** (`src/common/message/store/index.ts`):

- `alertMessageState`: Global alert messages
- `confirmMessageState`: Global confirmation dialogs

### Auth Hook Usage

```typescript
import { useAuth } from '@/common/hooks/auth/useAuth'

const { isReady, isAuthenticated, userData, login, logout } = useAuth()

if (!isReady) return <div>로딩 중...</div>
if (!isAuthenticated) return <Login />
```

## HTTP Client & API

### Axios Configuration (`src/utils/http/client.ts`)

- Base URL: `/api` (proxied to `http://localhost:8080` in dev)
- Authorization header automatically injected from localStorage
- Token refresh handled via response headers
- Token expiration redirects to login with alert

### API Client Generation (Orval)

- Config: `config/orval.config.ts`
- Generates typed API clients to `src/gen/`
- Run `yarn orval` after API spec changes

## Routing

Three layout types in `src/router/index.tsx`:

1. **AuthenticationLayout**: Protected routes (auth check required)
2. **BaseLayout**: Main app layout with header/footer
3. **FullScreenLayout**: Full-screen pages (login, etc.)

## Testing (Vitest)

- Config in `vite.config.ts` (test block)
- Global APIs enabled (`describe`, `it`, `expect` without imports)
- Setup file: `src/test/setup.ts`
- Coverage thresholds: 80% (lines, functions, branches, statements)

## Storybook

- Config: `.storybook/main.ts`
- Stories: `**/*.stories.(ts|tsx)`
- Includes accessibility addon (`@storybook/addon-a11y`)
- Design docs: `.storybook/docs/design/*.mdx`

## React Compiler

React Compiler is enabled via Babel plugin. This means:

- No manual `useMemo`/`useCallback` needed in most cases
- Dev/build performance may be impacted
- See `babel-plugin-react-compiler` in `vite.config.ts`

## CSS Modules

Project uses CSS Modules with convention:

- File pattern: `*.module.css`
- Naming: `[name]__[local]___[hash:base64:5]`
- Locals convention: `camelCase`

## Common Patterns

### Creating a Form Component

```typescript
import { FormInput } from '@/components/ui' // or @/common/components/ui
import { FormCheckbox } from '@/components/ui'
import { useShowAlertMessage } from '@/common/message/store'

const { register, handleSubmit, formState: { errors } } = useForm()
const showAlert = useShowAlertMessage()

<FormInput
  label="이름"
  error={errors.name?.message}
  {...register('name')}
/>
```

### Conditional Styling with Design Tokens

```typescript
const sizeClasses = {
  small: cn(padding.buttonSm, textCombinations.bodySm),
  medium: cn(padding.buttonMd, textCombinations.body),
  large: cn(padding.buttonLg, textCombinations.body),
}

<button className={sizeClasses[size]}>{label}</button>
```

### Icon Usage

```typescript
import { icons } from '@/constants/design/icons'

const Icon = icons.add  // or icons.success, icons.close, etc.
<Icon className={iconSizes.md} />
```

## Important Notes

- **API Proxy**: `/api` requests proxy to `http://localhost:8080` in dev
- **Storage Keys**: Defined in `src/constants/storage.ts`
- **Component Index**: `src/common/components/ui/index.ts` exports all UI components
- **Never use**: `position: absolute`, hardcoded colors/spacing, direct lucide-react imports

## 추가 정보

- [DESIGN_SYSTEM.md](./DESIGN_SYSTEM.md) - 디자인 시스템 가이드

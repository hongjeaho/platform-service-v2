# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is the **React frontend application** for the Spring Boot government land compensation adjudication platform. It provides the user interface for case management, document processing, and decision-making workflows.

**Current Status:** Production-ready foundation with complete tooling, infrastructure, and core state management setup. Business logic components and views are in active development.

## Build System & Commands

This project uses **Yarn** as the package manager and **Vite** as the build tool.

### Core Development Commands

```bash
# Start development server (port 3000, auto-opens in browser)
yarn dev

# Build for production (runs Orval, Prettier, ESLint fix, TypeScript check, Vite build)
yarn build

# Preview production build locally
yarn preview

# Run ESLint on TypeScript files
yarn lint:fix

# Format code with Prettier
yarn format
yarn format:check

# Generate API client code from OpenAPI spec
yarn orval
yarn orval:watch              # Watch mode for continuous regeneration
```

### Important Notes on Build Process

- **Pre-build checks:** The `yarn build` command automatically runs:
  1. Orval code generation
  2. Prettier formatting
  3. ESLint auto-fix
  4. TypeScript type checking
  5. Vite production build

- **Development workflow:** Use `yarn dev` for local development; this enables Fast Refresh and all source maps
- **Build verification:** Always run `yarn build` before committing to ensure all checks pass

## Technology Stack

**Core:**
- React 19 with TypeScript 5.9 (strict mode enabled)
- Vite 7 (build tool with Fast Refresh enabled)
- TailwindCSS 4 (utility-first styling)
- React Compiler (automatic memoization via babel-plugin-react-compiler)

**State Management & Data Fetching:**
- React Query (@tanstack/react-query v5) - Server state management with caching
- Jotai v2 - Lightweight atomic client state management
- Custom query options configured for development vs. production behavior

**Routing & Forms:**
- React Router v7 (modern APIs, v7 future features enabled)
- React Hook Form v7 (efficient form handling)

**HTTP & API:**
- Axios v1.13 (HTTP client with interceptors)
- Orval v8-rc2 (OpenAPI/Swagger client code generation)
- Custom mutator (request.ts) and form data handler (config/orval.requestFormData.ts)

**Utilities & Libraries:**
- date-fns v4 - Date manipulation and formatting
- lucide-react - Icon library
- clsx & tailwind-merge - Utility for conditional CSS classes
- class-variance-authority - Type-safe component variants

**Development Tools:**
- ESLint v9 (flat config) with TypeScript, React, and React Hooks plugins
- Prettier v3 - Code formatter (single quotes, no semicolons, 100 char width)
- Rollup Visualizer - Bundle analysis
- React Query DevTools - Development diagnostics
- TailwindCSS Vite plugin - Optimized CSS generation

## Project Structure

### Directory Layout

```
src/
├── layout/                    # Layout wrapper components
│   ├── AuthenticationLayout.tsx  # Auth flow layouts
│   ├── BaseLayout.tsx           # Main app layouts
│   ├── FullScreenLayout.tsx     # Full-screen layouts
│   └── ErrorPage.tsx            # Error boundary/404 page
├── router/
│   └── index.tsx               # React Router v7 configuration
├── views/                      # Page-level components (routed screens)
│   ├── Home.tsx
│   ├── login/
│   │   └── LoginApplication.tsx
│   └── [other pages...]
├── common/                     # Shared utilities and components
│   ├── components/
│   │   ├── header/
│   │   │   └── CommonHeader.tsx
│   │   ├── footer/
│   │   │   └── CommonFooter.tsx
│   │   └── message/            # Toast/notification system
│   │       └── store/          # Message Jotai atoms
│   └── hooks/
│       ├── auth/
│       │   ├── store/          # Jotai auth atoms
│       │   ├── type/           # Auth-related types
│       │   ├── useAuth.ts      # Main auth hook
│       │   ├── usePermission.ts # Permission checking
│       │   ├── useRequireAuth.ts # Route guard
│       │   └── useRouteGuard.ts # Advanced route protection
│       ├── useScrollToTopEffect.tsx # Auto-scroll on navigation
│       └── useGetJudgSeq.ts    # Domain-specific hook
├── utils/
│   └── http/                   # HTTP client configuration
│       ├── client.ts           # Axios instance + interceptors
│       ├── request.ts          # Request mutator for Orval
│       └── index.ts            # Exports
├── gen/                        # AUTO-GENERATED by Orval (do not edit)
│   ├── hooks/                  # Generated React Query hooks (by API tag)
│   │   ├── account-profile-api/
│   │   ├── admin-committee-member-api/
│   │   ├── board-api/
│   │   └── [60+ other API hooks...]
│   └── model/                  # Generated TypeScript types from OpenAPI schemas
├── components/                 # Reusable UI components (future)
├── constants/                  # Application constants
├── assets/                     # Static files (images, fonts, etc.)
├── lib/                        # Utility functions library
├── index.css                   # Global styles (TailwindCSS)
├── main.tsx                    # React app entry point
├── App.tsx                     # Root app component
└── vite-env.d.ts              # Vite type declarations
```

### Key Directory Notes

- **src/gen/** is auto-generated by Orval and **must not be manually edited**. Regenerate using `yarn orval` after backend API changes.
- **src/common/hooks/auth/** contains all authentication and authorization logic
- **src/utils/http/** is the single source of truth for HTTP configuration
- **src/layout/** wraps entire route trees and persists across navigation
- **src/views/** contains page-level components that change with routes

## TypeScript Path Aliases

Path aliases are defined in `tsconfig.paths.json` for clean, maintainable imports:

```typescript
@/*              → src/*
@components/*    → src/components/*
@constants/*     → src/constants/*
@utils/*         → src/utils/*
@views/*         → src/views/*
@router/*        → src/router/*
@hooks/*         → src/common/hooks/*
@api/*           → src/gen/*  (auto-generated API hooks)
```

**Always use aliases** for imports; relative imports should only be used within tightly-coupled modules.

## HTTP Client Architecture

### Axios Configuration

The custom Axios instance (`src/utils/http/client.ts`) includes:

1. **Request Interceptor:**
   - Automatically attaches JWT Bearer token from localStorage (key: `authorization`)

2. **Response Interceptor:**
   - Updates JWT token from response headers
   - Handles file downloads (extracts filename from `content-disposition` header)
   - Implements "download and trigger browser save" pattern

3. **Error Interceptor:**
   - Detects token expiration via `x-token-expired` header
   - Clears auth state and shows alert
   - Prevents duplicate alerts

### Orval-Generated API Hooks

- **Location:** `src/gen/hooks/` (organized by API tag)
- **Type:** React Query hooks (useQuery, useMutation)
- **Transport:** Custom mutator (`src/utils/http/request.ts`)
- **Form Data:** Custom handler supports File objects and nested data serialization
- **Configuration:** See `config/base.orval.config.ts` for customization

**Usage Example:**
```typescript
import { useGetUser } from '@api/user-api/user-api'

export function UserProfile() {
  const { data: user, isLoading, error } = useGetUser({ userId: '123' })
  // ...
}
```

## State Management Architecture

### Server State (React Query)

**Configured in:** `src/main.tsx` and `config/custom.query.options.ts`

- **Caching:** 5-minute staleTime in production (0 in dev for fast feedback)
- **Garbage Collection:** 10-minute gcTime
- **Retry Strategy:**
  - 4xx errors fail immediately (user error)
  - 5xx errors retry up to 2 times with exponential backoff (max 30s)
- **Refetch Behavior:**
  - Development: Refetch on window focus
  - Production: Disabled (efficiency)
  - Always: Refetch on network reconnect

**Custom hook options** ensure Mutation requests don't retry (avoiding duplicate operations).

### Client State (Jotai)

**Configured in:** `src/main.tsx` (custom store instance for interceptor access)

- **Auth State:** `src/common/hooks/auth/store/auth/index.ts`
  - User credentials
  - Authentication status
  - Hydration state (SSR-safe)
- **Message State:** `src/common/hooks/auth/store/message/index.ts`
  - Toast/alert notifications
  - Callback-based dismissal

**Why separate store in main.tsx:** HTTP interceptors (running outside React) need direct access to Jotai atoms. A custom store instance enables this.

## Authentication & Authorization

### JWT Token Flow

1. **Token Storage:** localStorage key `authorization`
2. **Format:** `Bearer <token>`
3. **Refresh:** Server includes new token in response headers
4. **Expiration:** Backend sends `x-token-expired: true` header

### Auth Hook (`useAuth`)

```typescript
const {
  isAuthenticated,    // boolean
  isHydrated,        // false during SSR, true after client hydration
  userData,          // User | null
  login,             // (user: User) => void
  logout,            // () => void
  isReady,           // Alias for isHydrated
  hasUser,           // Alias for isAuthenticated
} = useAuth()
```

### Permission Checking

- `usePermission()` - Validate user roles/permissions
- `useRequireAuth()` - Block components if not authenticated (shows nothing)
- `useRouteGuard()` - Advanced route protection with redirects

## Code Quality & Linting

### ESLint Rules (in `eslint.config.js`)

**Key Enforced Rules:**
- No `var` (use const/let)
- Simple import sort (organized by: imports, blank line, exports)
- React Hooks exhaustive-deps **disabled** (custom management required)
- No unused variables or parameters
- TypeScript strict mode compliance

**Key Relaxed Rules:**
- `@typescript-eslint/no-explicit-any` - Sometimes necessary for generated code
- `react-refresh/only-export-components` - Allow side effects
- `@tanstack/query/prefer-query-object-syntax` - Disabled, using function syntax

**Ignored Paths:** `/dist`, `/node_modules`, `/src/utils/gen/**` (generated code)

### Prettier Configuration

```javascript
{
  singleQuote: true,          // Use single quotes
  jsxSingleQuote: true,       // Single quotes in JSX
  semi: false,                // No semicolons
  useTabs: false,             // Spaces, not tabs
  tabWidth: 2,                // 2-space indentation
  trailingComma: 'all',       // Trailing commas in all arrays/objects
  printWidth: 100,            // Max line length
  arrowParens: 'avoid',       // Single params without parens: x => {}
  bracketSameLine: false,     // JSX closing > on next line
  endOfLine: 'auto',          // Handle different line endings
}
```

## Vite Build Configuration

### Code Splitting

The production build automatically splits chunks by dependency:
- `react.js` - Core React
- `react-dom.js` - React DOM
- `react-router-dom.js` - Routing
- `state.js` - React Query, Jotai, Axios
- `form.js` - React Hook Form
- `date-fns.js` - Date utilities
- `icons.js` - Lucide React
- `kakao-maps.js` - Kakao Maps (when added)
- `vendor.js` - Other node_modules
- `[name].js` - Application code

**Benefit:** Efficient caching; vendor libraries change infrequently

### Source Maps

- **Development:** Enabled for debugging (`sourcemap: isDev`)
- **Production:** Disabled for smaller bundle (`minify: !isDev`)

### Build Artifact Visualization

`rollup-plugin-visualizer` opens automatically during `yarn build` to show bundle composition.

## Orval API Client Generation

### Configuration Files

**config/orval.config.ts** - Main configuration
- Environment-aware API URL (`VITE_API_BASE_URL`)
- Fallback: `http://localhost:8080/api/public/api-docs/json`
- Development: Optional mock enablement via `VITE_ENABLE_MOCK`

**config/base.orval.config.ts** - Shared output configuration
- Mode: `tags-split` (one hook file per API tag)
- Target: `src/gen/hooks` and `src/gen/model`
- Client: React Query with Axios
- Auto-formatting with Prettier

**config/custom.query.options.ts** - React Query customization
- Development vs. production staleTime
- Retry logic for mutations and queries
- Refetch strategies

**config/orval.requestFormData.ts** - Form data serialization
- Handles File and Blob uploads
- Serializes nested objects/arrays as JSON Blobs
- Prevents null/undefined values

### Regenerating API Hooks

```bash
# One-time generation
yarn orval

# Watch mode (useful during backend API development)
yarn orval:watch
```

**When to regenerate:**
- Backend API endpoint changes
- OpenAPI schema updates
- New API tags added to backend

**Important:** Never manually edit `src/gen/` files; regenerate from OpenAPI spec.

## Development Patterns

### Component Structure

Use **functional components with hooks**:

```typescript
interface MyComponentProps {
  title: string
  onClick: () => void
}

export function MyComponent({ title, onClick }: MyComponentProps) {
  const [count, setCount] = useState(0)

  return (
    <div className="p-4 bg-blue-50">
      <h1>{title}</h1>
      <button onClick={onClick}>{count}</button>
    </div>
  )
}
```

### Data Fetching

Use **Orval-generated React Query hooks**:

```typescript
// Generated hook
import { useGetUser } from '@api/user-api/user-api'

export function UserCard({ userId }: { userId: string }) {
  const { data: user, isLoading, error } = useGetUser({ userId })

  if (isLoading) return <div>Loading...</div>
  if (error) return <div>Error: {error.message}</div>

  return <div>{user?.name}</div>
}
```

### Forms

Use **React Hook Form** for efficient form state:

```typescript
import { useForm } from 'react-hook-form'

export function LoginForm() {
  const { register, handleSubmit, formState: { errors } } = useForm()
  const { mutate: login } = useLoginMutation()

  return (
    <form onSubmit={handleSubmit(data => login(data))}>
      <input {...register('email', { required: true })} />
      {errors.email && <span>Required</span>}
      <button type="submit">Login</button>
    </form>
  )
}
```

### Styling

Use **TailwindCSS utility classes**:

```typescript
export function Card({ title, children }: { title: string; children: React.ReactNode }) {
  return (
    <div className="rounded-lg border border-gray-200 bg-white p-4 shadow-sm hover:shadow-md transition-shadow">
      <h2 className="text-lg font-semibold text-gray-900">{title}</h2>
      <div className="mt-2 text-gray-600">{children}</div>
    </div>
  )
}
```

**For dynamic classes, use clsx:**
```typescript
import clsx from 'clsx'

<button className={clsx('px-4 py-2', variant === 'primary' && 'bg-blue-600 text-white')} />
```

### Custom Hooks

Place reusable logic in `src/common/hooks/`:

```typescript
// src/common/hooks/useUserData.ts
import { useQuery } from '@tanstack/react-query'

export function useUserData(userId: string) {
  return useQuery({
    queryKey: ['user', userId],
    queryFn: async () => { /* ... */ },
  })
}
```

### Error Handling

Use **boundary components** for error states:

```typescript
import { useRouteError } from 'react-router-dom'

export function ErrorPage() {
  const error = useRouteError()

  return (
    <div className="p-8">
      <h1>Error</h1>
      <pre>{JSON.stringify(error, null, 2)}</pre>
    </div>
  )
}
```

## Routing Architecture

**Configuration:** `src/router/index.tsx`

**Layout Structure:**
1. **AuthenticationLayout** - Wraps login and auth flows
2. **BaseLayout** - Main app layout with header/footer
3. **FullScreenLayout** - Full-screen components (login page)

**Router Features:**
- React Router v7 with future flags enabled
- `createBrowserRouter` for client-side routing
- Nested route support

**Adding Routes:**
```typescript
// In src/router/index.tsx
{
  path: '/cases',
  element: <BaseLayout />,
  children: [
    {
      path: ':caseId',
      element: <CaseDetail />,
    },
  ],
}
```

## Environment Variables

Environment variables should be prefixed with `VITE_` to be accessible in browser code.

**Available variables:**
- `VITE_API_BASE_URL` - Override backend API URL (used by Orval)
- `VITE_ENABLE_MOCK` - Enable Orval mock responses in development

**Usage:**
```typescript
const apiUrl = import.meta.env.VITE_API_BASE_URL
```

## Debugging & Development Tools

### React Query DevTools

Enabled automatically in development mode. Shows:
- Cached queries and mutations
- Query state and timestamps
- Network request details

Toggle with the floating button (bottom right during dev).

### Vite HMR (Hot Module Replacement)

Fast Refresh is enabled. Changes to:
- React components auto-refresh without losing state
- CSS updates instantly
- Export-only components reload cleanly

### TypeScript Checking

Type check before building:
```bash
yarn tsc -b
```

## Common Development Tasks

### Adding a New Page

1. Create page component in `src/views/[feature]/Page.tsx`
2. Add route in `src/router/index.tsx`
3. Use `useAuth()` for access control
4. Fetch data with Orval-generated hooks

### Adding a Shared Component

1. Create in `src/common/components/[feature]/Component.tsx`
2. Export from `src/common/components/index.ts`
3. Import using `@components/*` alias

### Adding a Custom Hook

1. Create in `src/common/hooks/useMyHook.ts`
2. Export from `src/common/hooks/index.ts`
3. Import using `@hooks/*` alias

### Integrating a New Backend API

1. Ensure backend exposes OpenAPI 3.0 spec at `/api/public/api-docs/json`
2. Run `yarn orval`
3. Use generated hooks from `src/gen/hooks/`

### Debugging Network Requests

1. Open DevTools Network tab
2. Check Axios interceptors in `src/utils/http/client.ts`
3. Enable `logLevel: 'info'` in Orval config for verbose logging
4. Use React Query DevTools for cached data inspection

## Known Limitations & Notes

- **React Compiler:** Impacts build performance; disable `babel-plugin-react-compiler` in `vite.config.ts` if needed
- **Exhaustive deps:** ESLint rule disabled; carefully manage dependencies to avoid stale closures
- **Server state sync:** Manual refetch via React Query key invalidation is responsibility of caller
- **File uploads:** FormData serialization via custom handler; test with backend form expectations
- **Kakao Maps:** Not yet installed; will be needed for location-based features

## Backend Integration Reference

For API documentation and available endpoints:
- **Swagger UI:** http://localhost:8080/swagger-ui.html (after backend starts)
- **OpenAPI JSON:** http://localhost:8080/api/public/api-docs/json
- **Backend repository:** Spring Boot multi-module application (see root CLAUDE.md)

## Important Files Reference

- **tsconfig.json / tsconfig.app.json** - TypeScript configuration (strict mode, ES2022 target)
- **vite.config.ts** - Vite build configuration (code splitting, plugins)
- **eslint.config.js** - ESLint flat config with rules
- **.prettierrc.cjs** - Code formatting rules
- **config/orval.config.ts** - API client generation configuration
- **src/main.tsx** - App initialization and provider setup
- **src/router/index.tsx** - Route definitions
- **src/utils/http/client.ts** - HTTP client and interceptors
- **src/common/hooks/auth/** - Authentication logic
